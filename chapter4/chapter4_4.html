<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Определение и Свойства NURBS Поверхностей</title>
    <link rel="stylesheet" href="../css/Pagestyle.css" />
    <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=AM_CHTML'></script>
</head>

<body>
    <div class="header">Глава IV</div>
    <div class="section"><b>4.4.</b> Определение и Свойства NURBS Поверхностей</div>

    <p>NURBS поверхность степени `p` в `u` направлении и степени `q` в `v` направлении двумерная вектор-кусочная
        рациональная функция вида</p>

    <p class="formula">
        `S(u,v)=(sum_(i=0)^nsum_(j=0)^mN_(i,p)(u)N_(j,q)(v)w_(i,j)P_(i,j))/(sum_(i=0)^nsum_(j=0)^mN_(i,p)(u)N_(j,q)(v)w_(i,j))`
        &emsp; `0≤u,v≤1`<a name="f4_11" class="nomer">(4.11)</a></p>

    `{P_(i,j)}` образуют двунаправленную сеть управления, `{w_(i,j)}` являются весами, и `{N_(i,p)(u)}` и `{N_(j,q)(v)}`
    являются не рациональными B-сплайнами базисных функций определённых на узловых векторах

    <p class="formula">`U="{"ubrace(0,…,0)_(p+1),u_(p+1),…,u_(r-p-1),ubrace(1,…,1)_(p+1)"}"`</p>
    <p class="formula">`V="{"ubrace(0,…,0)_(q+1),v_(q+1),…,v_(s-q-1),ubrace(1,…,1)_(q+1)"}"`</p>

    где `r=n+p+1` и `s=m+q+1`.

    <p>Представляем кусочно рациональные базисные функции</p>

    <p class="formula">
        `R_(i,j)(u,v)=(N_(i,p)(u)N_(j,q)(v)w_(i,j))/(sum_(k=0)^nsum_(l=0)^mN_(k,p)(u)N_(l,q)(v)w_(k,l))`
        <a name="f4_12" class="nomer">(4.12)</a></p>

    поверхность из <a href="#f4_11">формулы (4.11) </a>можно записать как

    <p class="formula">`S(u,v)=sum_(i=0)^nsum_(j=0)^mR_(i,j)(u,v)P_(i,j)`<a name="f4_13" class="nomer">(4.13)</a></p>

    <a href="#img4_8">Рисунки 4.8</a> и <a href="#img4_8">4.9</a> демонстрируют примеры NURBS поверхностей.

    <a name="img4_8">
        <iframe frameborder="0" seamless src="aframe/img4_8a.html" allowfullscreen="yes" allowvr="yes" vspace="500"
            width="600" height="500" align="left">
            Ваш браузер не поддерживает плавающие фреймы!
        </iframe>
        <iframe frameborder="0" seamless src="aframe/img4_8b.html" allowfullscreen="yes" allowvr="yes" vspace="500"
            width="600" height="500" align="left">
            Ваш браузер не поддерживает плавающие фреймы!
        </iframe>
        <p class="pictxt">Рисунок 4.8. Контрольная сеть и биквадратичная поверхность NURBS,
            `w_{1,1}=w_{1,2}=w_{2,1}=w_{2,2}=10`, с остальными весами 1. `U=V={0,0,0,`1⁄3,2⁄3,`1,1,1}`.
            (a) контрольная сеть; (b) биквадратичная поверхность NURBS..</p>
    </a>

    <a name="img4_9">
        <iframe frameborder="0" seamless src="aframe/img4_9.html" allowfullscreen="yes" allowvr="yes" vspace="500"
            width="600" height="500" align="left">
            Ваш браузер не поддерживает плавающие фреймы!
        </iframe>
        <p class="pictxt">Рисунок 4.9. Поверхность бикубических NURBS, определенная контрольной сеткой на рисунке 4.8a,
            с `U=V={0,0,0,`1⁄2,`1,1,1}` и с такими же весами, что и на рисунках 4.8.</p>
    </a>

    <p>Важные свойства функций `R_(i,j)(u,v)` примерно те же, что приведены в
        <a href="..\chapter3\chapter3_4.html">разделе 3.4</a> для не рациональных базисных функций,
        `N_(i,p)(u)N_(j,q)(v)`. Мы суммируем их здесь.</p>

    <table>
        <tr>
            <td><a name="pr4_15"><b>Св.4.15</b></a></td>
            <td>Не отрицательность: `R_(i,j)(u,v)≥0` для всех `i`, `j`, `u` и `v`;</td>
        </tr>
        <tr>
            <td><a name="pr4_16"><b>Св.4.16</b></a></td>
            <td>Разбиение единицы: `∑_(i=0)^n∑_(j=0)^mR_(i,j)(u,v)=1` для всех `(u,v)∈[0,1]×[0,1]`;</td>
        </tr>
        <tr>
            <td><a name="pr4_17"><b>Св.4.17</b></a></td>
            <td>Локальная поддержка: `R_(i,j)(u,v)=0` если `(u,v)` находится за пределами прямоугольника заданного
                `[u_i,u_(i+p+1))×x[v_j,v_(j+q+1))`;</td>
        </tr>
        <tr>
            <td><a name="pr4_18"><b>Св.4.18</b></a></td>
            <td>В любом данном прямоугольнике формы `[u_(i_0),u_(i_0+1))x×[v_(j_0),v_(j_0+1))`, в крайнем случае
                `(p+1)(q+1)` базисные функции не равны нулю, в частности, `R_(i,j)(u,v)` для `i_0-p≤i≤i_0` и
                `j_0-q≤j≤j_0` отличны от нуля;</td>
        </tr>
        <tr>
            <td><a name="pr4_19"><b>Св.4.19</b></a></td>
            <td>Экстремум: Если `p>0` и `q>0`, тогда `R_(i,j)(u,v)` достигает только одного максимального значения;</td>
        </tr>
        <tr>
            <td><a name="pr4_20"><b>Св.4.20</b></a></td>
            <td>`R_{0,0}(0,0)=R_(n,0)(1,0)=R_(0,m)(0,1)=R_(n,m)(1,1)=1`;</td>
        </tr>
        <tr>
            <td><a name="pr4_21"><b>Св.4.21</b></a></td>
            <td>О дифференцируемости: внутри прямоугольника, образованного `u` и `v` узловыми линиями, все частные
                производные `R_(i,j)(u,v)` существуют. В `u` узле (`v` узле), она `p-k` (`q-k`) раз дифференцируема в
                `u` (`v`) направлении, где `k` является кратность узла;</td>
        </tr>
        <tr>
            <td><a name="pr4_22"><b>Св.4.22</b></a></td>
            <td>Если все `w_(i,j)=a` для `0≤i≤n`, `0≤j≤m` и `a≠0`, тогда `R_(i,j)(u,v)=N_(i,p)(u)N_(j,q)(v)` для всех
                `i`, `j`;</td>
        </tr>
    </table>

    <p>Свойства Св.4.15 - Св.4.22 дают следующие важные геометрические свойства NURBS поверхностей:</p>

    <table>
        <tr>
            <td><a name="pr4_23"><b>Св.4.23</b></a></td>
            <td>Интерполяция угловых точек: `S(0,0)=P_{0,0}`, `S(1,0)=P_(n,0)`, `S(0,1)=P_(0,m)`, и `S(1,1)=P_(n,m)`
            </td>
        </tr>
        <tr>
            <td><a name="pr4_24"><b>Св.4.24</b></a></td>
            <td>Аффинная инвариантность: аффинное преобразование, применяемое к поверхности, применяется к её
                контрольным точкам;</td>
        </tr>
        <tr>
            <td><a name="pr4_25"><b>Св.4.25</b></a></td>
            <td>Сильное свойство выпуклой оболочки: предположим `w_(i,j)≥0` для всех `i`, `j`. Если
                `(u,v)∈[u_(i_0),u_(i_0+1))×[v_(j_0),v_(j_0+1))`, тогда `S(u,v)` выпуклая оболочка контрольных точек
                `P_(i,j)`, `i_0-p≤i≤i_0` и `j_0-q≤j≤j_0`;</td>
        </tr>
        <tr>
            <td><a name="pr4_26"><b>Св.4.26</b></a></td>
            <td>Местное изменение: если `P_(i,j)` перемещается, или меняется, это влияет на форму поверхности только в
                прямоугольнике `[u_i,u_(i+p+1))×[v_j,v_(j+q+1))`;</td>
        </tr>
        <tr>
            <td><a name="pr4_27"><b>Св.4.27</b></a></td>
            <td>Нерациональные B-сплайны, и Безье, и рациональные Безье поверхности – всё частные случаи поверхностей
                NURBS;</td>
        </tr>
        <tr>
            <td><a name="pr4_28"><b>Св.4.28</b></a></td>
            <td>О дифференцируемости: `S(u,v)` `p-k` (`q-k`) раз дифференцируема в `u` (`v`) направлении, где `k`
                является кратность узла;</td>
        </tr>
    </table>

    Заметим, что нет никакого известного свойства изменения уменьшения для NURBS поверхностей (смотри [
    <a href="..\references.html#Prau92">Prau92</a>]).

    <p>Мы можем использовать как движение точки управления и модификации веса для локального изменения формы NURBS
        поверхностей. <a href="#img4_10">Рисунки 4.10</a> и <a href="#img4_11">4.11</a> показывают изменения базисной
        функции `R_(i,j)(u,v)` и формы поверхности, когда одиночный вес, `w_(i,j)`, будет изменен. Сравните эти рисунки
        с рисунками <a href="..\chapter3\chapter3_5.html#img3_19">3.19б</a> и
        <a href="..\chapter3\chapter3_5.html#img3_20">3.20а</a>, б. Качественно, эффект на поверхности: Предположим,
        `(u,v)∈[u_i,u_(i+p+1))×[v_j,v_(j+q+1))`; затем, если `w_(i,j)` увеличивается (уменьшается), точка `S(u,v)`
        приближается к (удаляется от) `P_(i,j)`, следовательно, поверхность притягивается к (отталкивается от)
        `P_(i,j)`. Как и в слу&shy;чае кривых, движение `S(u,v)` вдоль прямой линии. На <a href="#img4_12">рисунке
            4.12</a>
        `(u,v)` являются фиксированными и `w_{2,2}` меняется. Пусть</p>

    <p class="formula">`S=S(u,v;w_{2,2}=0)`</p>
    <p class="formula">`M=S(u,v;w_{2,2}=1)`<a name="f4_14" class="nomer">(4.14)</a></p>

    Тогда прямая определённая `S` и `M` проходит через `P_{2,2}`, а для произвольной `w_{2,2}`, `0&lt;w_{2,2}&lt;∞`,
    `S_{2,2}` лежит на этом сегменте линии между `S` и `P_{2,2}`.

    <a name="img4_10">
        <iframe frameborder="0" seamless src="aframe/img4_10a.html" allowfullscreen="yes" allowvr="yes" vspace="500"
            width="600" height="500" align="left">
            Ваш браузер не поддерживает плавающие фреймы!
        </iframe>
        <iframe frameborder="0" seamless src="aframe/img4_10b.html" allowfullscreen="yes" allowvr="yes" vspace="500"
            width="600" height="500" align="left">
            Ваш браузер не поддерживает плавающие фреймы!
        </iframe>
        <p class="pictxt">Рисунок 4.10. Базисная функция `R_{4,2}(u,v)`, с `U={0,0,0,0,`1⁄4,1⁄2,3⁄4,`1,1,1,1}` и
            `V={0,0,0,`1⁄5,2⁄5,3⁄5,3⁄5,4⁄5,`1,1,1}`. `w_{i,4}=1` для всех `(i,j)!=(4,2)`. (a) `w_{4,2}=`2⁄5; (b)
            `w_{4,2}=6`.</p>
    </a>

    <a name="img4_11">
        <iframe frameborder="0" seamless src="aframe/img4_11a.html" allowfullscreen="yes" allowvr="yes" vspace="500"
            width="600" height="500" align="left">
            Ваш браузер не поддерживает плавающие фреймы!
        </iframe>
        <iframe frameborder="0" seamless src="aframe/img4_11b.html" allowfullscreen="yes" allowvr="yes" vspace="500"
            width="600" height="500" align="left">
            Ваш браузер не поддерживает плавающие фреймы!
        </iframe>
        <p class="pictxt">Рисунок 4.11. Кубические `xx` квадратичные поверхности, соответствующие рисунку 4.10, со
            смещением контрольной сетки для лучшей визуализации, (a) `w_{4,2}=`2⁄5; (b) `w_{4,2}=6`.</p>
    </a>

    <a name="img4_12">
        <iframe frameborder="0" seamless src="aframe/img4_12.html" allowfullscreen="yes" allowvr="yes" vspace="500"
            width="600" height="500" align="left">
            Ваш браузер не поддерживает плавающие фреймы!
        </iframe>
        <p class="pictxt">Рисунок 4.12. Модификация веса `w_{2,2}`.</p>
    </a>

    <p>Это удобно для представления NURBS поверхности с помощью однородных координат, то есть</p>

    <p class="formula">`S^w(u,v)=sum_(i=0)^nsum_(j=0)^mN_(i,p)(u)N_(j,q)(v)P_(i,j)^w`<a name="f4_15"
            class="nomer">(4.15)</a></p>

    где `P_(i,j)^w=(w_(i,j)x_(i,j),w_(i,j)y_(i,j),w_(i,j)z_(i,j),w_(i,j))`. Тогда `S(u,v)=H{S^w(u,v)}`. Мы имеем в виду
    попеременно либо `S^w(u,v)` или `S(u,v)` для поверхности NURBS. Строго говоря, `S^w(u,v)` является тензорным
    произведением, кусочно-многочленной поверхности в четырехмерном пространстве. `S(u,v)` является кусочно-рациональной
    поверхностью в трехмерном пространстве; это не является поверхностью тензорного произведения, так как `R_(i,j)(u,v)`
    не являются продуктами одномерных базисных функций.

    <p><b>Примеры</b></p>
    <table>
        <tr>
            <td><b>Пример4.3</b></td>
            <td>Пусть `S^w(u,v)=sum_{i=0}^7sum_{j=0}^4N_{i,2}(u)N_{j,2}(v)`, с
                <p class="formula">`U={0,0,0,1,2,3,4,4,5,5,5}`</p>
                <p class="formula">и &emsp; `V={0,0,0,1,2,3,3,3}`</p>
                Оценим поверхность при `(u,v)=(5/2,1)`. Тогда `u in [u4, u5)` и `v in [v_3,v_4)`, и из
                <a href="..\chapter3\chapter3_2.html">разделов 3.2</a> и <a href="chapter4_2.html">4.2</a> мы знаем,
                что

                <p class="formula">`N_{2,2}(5/2)=1/8` &emsp; `N_{3,2}(5/2)=6/8` &emsp; `N_{4,2}(5/2)=1/8`</p>

                <p class="formula">и &emsp; `N_{1,2}(1)=1/2` &emsp; `N_{2,2}(1)=1/2` &emsp; `N_{3,2}(1)=0`</p>

                Теперь предположим, что

                <p class="formula">`[P_{i,j}^w]=[["(0,2,4,1)","(0,6,4,2)","(0,2,0,1)"],
                    ["(4,6,8,2)","(12,24,12,6)","(4,6,0,2)"], ["(4,2,4,1)","(8,6,4,2)","(4,2,0,1)"]]`</p>
                <p class="formula">`i=2,3,4` &emsp; `j=1,2,3`</p>

                Тогда

                <p class="formula">`S^w(5/2,1)=[1/8 6/8 1/8] xx [["(0,2,4,1)","(0,6,4,2)","(0,2,0,1)"],
                    ["(4,6,8,2)","(12,24,12,6)","(4,6,0,2)"], ["(4,2,4,1)","(8,6,4,2)","(4,2,0,1)"]] [[1/2],[1/2],[0]]`
                    `=(54/8,98/8,68/8,27/8)`</p>

                Проекция даёт

                <p class="formula">`S(5/2,1)=(2,98/27,68/27)`</p>
            </td>
        </tr>
    </table>

    <p><a href="..\chapter3\chapter3_4.html#al3_5">Алгоритм A3.5</a> можно адаптировать для вычисления точки на
        рациональной поверхности В-сплайна, просто позволяя массиву Р содержать взвешенные контрольные точки
        (использование Pw), накапливая четырехмерные точки поверхности в Sw и вставляя линии S = Sw/w в конце алгоритма.
    </p>

    <p><a name="al4_3"><b>Алгоритм А4.3</b></a></p>
    <pre>
SurfacePoint(n,p,U,m,q,V,Pw,u,v,S)
{ /* Вычислить  точку  на  рациональной  B-сплайн  поверхности */
  /* Вход: n,p,U,m,q,V,Pw,u,v */
  /* Выход: S */
uspan = FindSpan(n,p,u,U);
BasisFuns(uspan,u,p,U,Nu);
vspan = FindSpan(m,q,v,V);
BasisFuns(vspan,v,q,V,Nv);
uind = uspan – p;
S = 0.0;
for (l=0; l&lt;=q; l++)
   {
   temp[l] = 0.0;
   for (k=0; k&lt;=p; k++)
      temp[l] = temp[l] + Nu[k]*Pw[uspan – p +k][vspan – q + l];
   }
Sw = 0.0;
for (l=0; l&lt;=q; l++)
   Sw = Sw + Nv[l]*temp[l];
S = Sw/w;
}
    </pre>

    <p>Применяя <a href="..\chapter3\chapter3_4.html#f3_14">формулы (3.14)</a> и
        <a href="..\chapter3\chapter3_4.html#f3_15">(3.15)</a>, мы получим изопараметрические кривые на NURBS
        поверхности. Во-первых, установим `u=u_0`</p>

    <p class="formula">`С_(u_0)^w=S^w(u_0,v)=sum_(i=0)^nsum_(j=0)^mN_(i,p)(u_0)N_(j,q)(v)P_(i,j)^w`
        <a name="f4_16" class="nomer">(4.16)</a></p>
    <p class="formula">`=sum_(j=0)^mN_(j,q)(v)(sum_(i=0)^nN_(i,p)(u_0)P_(i,j)^w)=sum_(j=0)^mN_(j,q)(v)Q_j^w(u_0)`</p>

    <p class="formula">где &emsp; `Q_j^w(u_0)=sum_(i=0)^nN_(i,p)(u_0)P_(i,j)^w`</p>
    <p class="formula">Аналогично &emsp; `С_(v_0)^w=sum_(i=0)^nN_(i,p)(u)Q_i^w(v_0)`
        <a name="f4_17" class="nomer">(4.17)</a></p>
    <p class="formula">где &emsp; `Q_i^w(v_0)=sum_(j=0)^mN_(j,q)(v_0)P_(i,j)^w`</p>

    `С_(u_0)^w`, `(С_(v_0)^w)` это `q`ой(`p`ой)-степени NURBS кривая с узловым вектором `V` (`U`). Точка `S^w(u_0,v_0)`
    лежит на
    пересечении `С_(u_0)^w` и `С_(v_0)^w`. Результат проекции

    <p class="formula">`С_(u_0)(v)=H{С_(u_0)^w(v)}=H{S^w(u_0,v)}=S(u_0,v)`</p>
    <p class="formula">`С_(v_0)(u)=H{С_(v_0)^w(u)}=H{S^w(u,v_0)}=S(u,v_0)`<a name="f4_18" class="nomer">(4.18)</a></p>


    <footer>
        <a href="chapter4_3.html">Назад</a>
        <a href="..\сontents.html">Содержание</a>
        <a href="chapter4_5.html">Вперёд</a>
    </footer>
</body>

</html>